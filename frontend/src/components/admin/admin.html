<!-- ğŸ” PANTALLA DE LOGIN -->
<div *ngIf="!isLoggedIn" class="login-container">
  <div class="login-card">
    <div class="login-header">
      <span class="emoji">ğŸ›¡ï¸</span>
      <h2>Panel de AdministraciÃ³n</h2>
      <p>Solo administradores con @onichip.com</p>
    </div>
    
    <form [formGroup]="loginForm" (ngSubmit)="login()">
      <div class="form-group">
        <label>Email de administrador</label>
        <input type="email" formControlName="email" placeholder="admin@onichip.com">
      </div>
      
      <div class="form-group">
        <label>ContraseÃ±a</label>
        <input type="password" formControlName="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      
      <div *ngIf="loginError" class="error-msg">{{ loginError }}</div>
      
      <button type="submit" [disabled]="loading" class="login-btn">
        <span *ngIf="!loading">ğŸ”“</span>
        {{ loading ? 'Verificando...' : 'Acceder al Panel' }}
      </button>
    </form>
  </div>
</div>

<!-- ğŸ›ï¸ PANEL PRINCIPAL DE ADMINISTRACIÃ“N -->
<div *ngIf="isLoggedIn" class="admin-panel">
  <!-- Header del admin -->
  <header class="admin-header">
    <div class="header-left">
      <span class="emoji">ğŸ›¡ï¸</span>
      <h1>Panel de AdministraciÃ³n</h1>
    </div>
    <div class="header-right">
      <span class="admin-info">
        <span class="emoji">ğŸ‘¨â€ğŸ’¼</span>
        {{ adminData?.nombre }} ({{ adminData?.rol }})
      </span>
      <button (click)="logout()" class="logout-btn">
        <span class="emoji">ğŸšª</span> Cerrar SesiÃ³n
      </button>
    </div>
  </header>

  <!-- NavegaciÃ³n por pestaÃ±as -->
  <nav class="admin-nav">
    <button 
      [class.active]="activeTab === 'dashboard'" 
      (click)="setActiveTab('dashboard')"
      class="nav-btn">
      <span class="emoji">ğŸ“Š</span> Dashboard
    </button>
    <button 
      [class.active]="activeTab === 'usuarios'" 
      (click)="setActiveTab('usuarios')"
      class="nav-btn">
      <span class="emoji">ğŸ‘¥</span> Usuarios
    </button>
    <button 
      [class.active]="activeTab === 'mascotas'" 
      (click)="setActiveTab('mascotas')"
      class="nav-btn">
      <span class="emoji">ğŸ•</span> Mascotas
    </button>
  </nav>

  <!-- Contenido principal -->
  <main class="admin-content">
    
    <!-- ğŸ“Š DASHBOARD -->
    <div *ngIf="activeTab === 'dashboard'" class="dashboard-tab">
      <!-- EstadÃ­sticas rÃ¡pidas -->
      <div class="stats-grid">
        <div class="stat-card primary">
          <span class="emoji">ğŸ‘¥</span>
          <div class="stat-info">
            <h3>{{ stats.totalUsuarios || 0 }}</h3>
            <p>Total Usuarios</p>
            <small>+{{ stats.nuevosUsuarios30d || 0 }} este mes</small>
          </div>
        </div>
        
        <div class="stat-card success">
          <span class="emoji">ğŸ•</span>
          <div class="stat-info">
            <h3>{{ stats.totalMascotas || 0 }}</h3>
            <p>Total Mascotas</p>
            <small>+{{ stats.nuevasMascotas30d || 0 }} este mes</small>
          </div>
        </div>
        
        <div class="stat-card warning">
          <span class="emoji">ğŸ“ˆ</span>
          <div class="stat-info">
            <h3>{{ ((stats.nuevosUsuarios30d || 0) * 100 / (stats.totalUsuarios || 1)).toFixed(1) }}%</h3>
            <p>Crecimiento</p>
            <small>Ãšltimos 30 dÃ­as</small>
          </div>
        </div>
        
        <div class="stat-card info">
          <span class="emoji">ğŸ¯</span>
          <div class="stat-info">
            <h3>{{ ((stats.totalMascotas || 0) / (stats.totalUsuarios || 1)).toFixed(1) }}</h3>
            <p>Mascotas/Usuario</p>
            <small>Promedio</small>
          </div>
        </div>
      </div>

      <!-- Alertas del sistema -->
      <div class="alerts-section">
        <h3><span class="emoji">ğŸš¨</span> Alertas del Sistema</h3>
        <div class="alerts-grid">
          <div *ngFor="let alerta of alertas" [class]="'alert ' + getAlertClass(alerta.tipo)">
            <span class="emoji">{{ alerta.icono }}</span>
            <div class="alert-content">
              <h4>{{ alerta.titulo }}</h4>
              <p>{{ alerta.mensaje }}</p>
            </div>
          </div>
          <div *ngIf="alertas.length === 0" class="alert alert-success">
            <span class="emoji">âœ…</span>
            <div class="alert-content">
              <h4>Todo en orden</h4>
              <p>No hay alertas en este momento</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Mascotas por especie -->
      <div class="charts-section">
        <h3><span class="emoji">ğŸ“Š</span> DistribuciÃ³n de Mascotas</h3>
        <div class="species-grid">
          <div *ngFor="let especie of stats.mascotasPorEspecie" class="species-card">
            <span class="emoji">{{ especie._id === 'Perro' ? 'ğŸ•' : especie._id === 'Gato' ? 'ğŸ±' : 'ğŸ¾' }}</span>
            <h4>{{ especie.count }}</h4>
            <p>{{ especie._id }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ‘¥ GESTIÃ“N DE USUARIOS -->
    <div *ngIf="activeTab === 'usuarios'" class="usuarios-tab">
      <div class="tab-header">
        <h2><span class="emoji">ğŸ‘¥</span> GestiÃ³n de Usuarios</h2>
        <div class="tab-actions">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              (keyup.enter)="onSearch()"
              placeholder="Buscar por nombre o email...">
            <button (click)="onSearch()">ğŸ”</button>
          </div>
          <button (click)="openUsuarioModal()" class="primary-btn">
            <span class="emoji">â•</span> Nuevo Usuario
          </button>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Usuario</th>
              <th>Email</th>
              <th>Mascotas</th>
              <th>Registro</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuarios">
              <td>
                <span 
                  class="id-badge" 
                  [title]="'ID completo: ' + usuario._id">
                  {{ getShortId(usuario._id) }}
                </span>
              </td>
              <td>
                <div class="user-info">
                  <span class="emoji">ğŸ‘¤</span>
                  <strong>{{ usuario.nombre }}</strong>
                </div>
              </td>
              <td>{{ usuario.email }}</td>
              <td>
                <span class="badge">{{ usuario.cantidadMascotas || 0 }}</span>
              </td>
              <td>{{ formatDate(usuario.createdAt || usuario.fechaRegistro) }}</td>
              <td>
                <div class="action-buttons">
                  <button (click)="openUsuarioModal(usuario)" class="edit-btn">âœï¸</button>
                  <button (click)="deleteUsuario(usuario._id)" class="delete-btn">ğŸ—‘ï¸</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination">
        <button (click)="prevPage()" [disabled]="usuariosPage <= 1">â† Anterior</button>
        <span>PÃ¡gina {{ usuariosPage }}</span>
        <button (click)="nextPage()">Siguiente â†’</button>
      </div>
    </div>

    <!-- ğŸ• GESTIÃ“N DE MASCOTAS -->
    <div *ngIf="activeTab === 'mascotas'" class="mascotas-tab">
      <div class="tab-header">
        <h2><span class="emoji">ğŸ•</span> GestiÃ³n de Mascotas</h2>
        <div class="tab-actions">
          <div class="search-box">
            <input 
              type="text" 
              [(ngModel)]="searchTerm" 
              (keyup.enter)="onSearch()"
              placeholder="Buscar por nombre o especie...">
            <button (click)="onSearch()">ğŸ”</button>
          </div>
          <button (click)="openMascotaModal()" class="primary-btn">
            <span class="emoji">â•</span> Nueva Mascota
          </button>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Mascota</th>
              <th>Especie</th>
              <th>Raza</th>
              <th>Edad</th>
              <th>Propietario</th>
              <th>Registro</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let mascota of mascotas">
              <td>
                <span 
                  class="id-badge" 
                  [title]="'ID completo: ' + mascota._id">
                  {{ getShortId(mascota._id) }}
                </span>
              </td>
              <td>
                <div class="pet-info">
                  <span class="emoji">{{ mascota.especie === 'Perro' ? 'ğŸ•' : 'ğŸ±' }}</span>
                  <strong>{{ mascota.nombre }}</strong>
                </div>
              </td>
              <td>{{ mascota.especie }}</td>
              <td>{{ mascota.raza }}</td>
              <td>{{ mascota.edad }} aÃ±os</td>
              <td>{{ mascota.propietario?.nombre || 'N/A' }}</td>
              <td>{{ formatDate(mascota.createdAt) }}</td>
              <td>
                <div class="action-buttons">
                  <button (click)="openMascotaModal(mascota)" class="edit-btn">âœï¸</button>
                  <button (click)="deleteMascota(mascota._id)" class="delete-btn">ğŸ—‘ï¸</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination">
        <button (click)="prevPage()" [disabled]="mascotasPage <= 1">â† Anterior</button>
        <span>PÃ¡gina {{ mascotasPage }}</span>
        <button (click)="nextPage()">Siguiente â†’</button>
      </div>
    </div>

  </main>
</div>

<!-- ğŸ“ MODAL USUARIO -->
<div *ngIf="showUsuarioModal" class="modal-overlay" (click)="closeUsuarioModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ editingUsuario ? 'Editar Usuario' : 'Nuevo Usuario' }}</h3>
      <button (click)="closeUsuarioModal()" class="close-btn">âœ•</button>
    </div>
    
    <form [formGroup]="usuarioForm" (ngSubmit)="saveUsuario()">
      <div class="form-group">
        <label>Nombre completo</label>
        <input type="text" formControlName="nombre" placeholder="Juan PÃ©rez">
      </div>
      
      <div class="form-group">
        <label>Email</label>
        <input type="email" formControlName="email" placeholder="usuario@email.com">
      </div>
      
      <div class="form-group">
        <label>{{ editingUsuario ? 'Nueva contraseÃ±a (opcional)' : 'ContraseÃ±a' }}</label>
        <input type="password" formControlName="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      
      <div class="form-group">
        <label>TelÃ©fono</label>
        <input type="tel" formControlName="telefono" placeholder="+1234567890">
      </div>
      
      <div class="modal-actions">
        <button type="button" (click)="closeUsuarioModal()" class="secondary-btn">Cancelar</button>
        <button type="submit" [disabled]="usuarioForm.invalid || loading" class="primary-btn">
          {{ loading ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ğŸ“ MODAL MASCOTA -->
<div *ngIf="showMascotaModal" class="modal-overlay" (click)="closeMascotaModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ editingMascota ? 'Editar Mascota' : 'Nueva Mascota' }}</h3>
      <button (click)="closeMascotaModal()" class="close-btn">âœ•</button>
    </div>
    
    <form [formGroup]="mascotaForm" (ngSubmit)="saveMascota()">
      <div class="form-group">
        <label>Nombre de la mascota</label>
        <input type="text" formControlName="nombre" placeholder="Firulais">
      </div>
      
      <div class="form-group">
        <label>Especie</label>
        <select formControlName="especie">
          <option value="">Seleccionar especie</option>
          <option value="Perro">Perro</option>
          <option value="Gato">Gato</option>
          <option value="Ave">Ave</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Raza</label>
        <input type="text" formControlName="raza" placeholder="Labrador">
      </div>
      
      <div class="form-group">
        <label>Edad (aÃ±os)</label>
        <input type="number" formControlName="edad" min="0" max="30">
      </div>
      
      <div class="form-group">
        <label>Propietario (ID)</label>
        <input type="text" formControlName="propietario" placeholder="ID del usuario">
      </div>
      
      <div class="modal-actions">
        <button type="button" (click)="closeMascotaModal()" class="secondary-btn">Cancelar</button>
        <button type="submit" [disabled]="mascotaForm.invalid || loading" class="primary-btn">
          {{ loading ? 'Guardando...' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>
</div>
