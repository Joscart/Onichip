<div class="mapa-gps-container" [style.height]="height">
  <!-- Mapa -->
  <div #mapContainer class="map-container"></div>
  
  <!-- Loading overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Cargando ubicaciones...</p>
  </div>

  <!-- Controles del mapa -->
  <div class="map-controls" *ngIf="showControls">
    <div class="control-group">
      <button 
        class="control-btn location-btn"
        [class.active]="autoCenter"
        (click)="centerOnCurrentLocation()"
        title="Centrar en ubicaciÃ³n actual">
        ğŸ“
      </button>
      
      <button 
        class="control-btn"
        [class.active]="showLocationHistory"
        (click)="toggleLocationHistory()"
        title="Mostrar historial de ubicaciones">
        ğŸ›¤ï¸
      </button>
      
      <button 
        class="control-btn"
        [class.active]="showGeofences"
        (click)="toggleGeofences()"
        title="Mostrar geofences">
        ğŸ”²
      </button>
      
      <button 
        class="control-btn"
        [class.active]="autoCenter"
        (click)="toggleAutoCenter()"
        title="Auto-centrar">
        ğŸ¯
      </button>
      
      <button 
        class="control-btn add-btn"
        (click)="startGeofenceCreation()"
        title="Crear geofence">
        â•
      </button>
    </div>
  </div>

  <!-- Panel de informaciÃ³n de ubicaciÃ³n actual -->
  <div class="location-info" *ngIf="currentLocation">
    <div class="info-header">
      <h4>ğŸ“ UbicaciÃ³n Actual</h4>
      <span class="method-badge" [ngClass]="currentLocation.method?.toLowerCase()">
        {{ currentLocation.method || 'GPS' }}
      </span>
    </div>
    
    <div class="info-content">
      <div class="info-row">
        <span class="info-label">PrecisiÃ³n:</span>
        <span class="info-value">{{ currentLocation.accuracy || 'N/A' }}m</span>
      </div>
      
      <div class="info-row">
        <span class="info-label">Velocidad:</span>
        <span class="info-value">{{ currentLocation.speed || 0 }} km/h</span>
      </div>
      
      <div class="info-row" *ngIf="currentLocation.battery">
        <span class="info-label">BaterÃ­a:</span>
        <span class="info-value">
          <span class="battery-indicator" [style.width.%]="currentLocation.battery.level">
            {{ currentLocation.battery.level }}%
          </span>
        </span>
      </div>
      
      <div class="info-row">
        <span class="info-label">Ãšltima actualizaciÃ³n:</span>
        <span class="info-value">{{ currentLocation.timestamp | date:'short' }}</span>
      </div>
    </div>
  </div>

  <!-- Panel de creaciÃ³n de geofence -->
  <div class="geofence-creator" *ngIf="showGeofenceCreator">
    <div class="creator-header">
      <h4>ğŸ”² Crear Geofence</h4>
      <button class="close-btn" (click)="cancelGeofenceCreation()">âœ•</button>
    </div>
    
    <div class="creator-content">
      <div class="form-group">
        <label>Nombre:</label>
        <input 
          type="text" 
          [(ngModel)]="newGeofence.name" 
          placeholder="Casa, Oficina, Parque...">
      </div>
      
      <div class="form-group">
        <label>DescripciÃ³n:</label>
        <input 
          type="text" 
          [(ngModel)]="newGeofence.description" 
          placeholder="DescripciÃ³n opcional">
      </div>
      
      <div class="form-actions">
        <button class="btn btn-cancel" (click)="cancelGeofenceCreation()">
          Cancelar
        </button>
        <button class="btn btn-save" (click)="saveGeofence()">
          Guardar
        </button>
      </div>
      
      <div class="creator-help" *ngIf="creatingGeofence">
        <p>ğŸ“Œ Haz clic en el mapa para seleccionar la ubicaciÃ³n del geofence</p>
      </div>
    </div>
  </div>

  <!-- Estado de conexiÃ³n -->
  <div class="connection-status" *ngIf="currentLocation">
    <div class="status-indicator" 
         [class.online]="currentLocation.method === 'GPS'"
         [class.offline]="currentLocation.method !== 'GPS'">
      <span class="status-dot"></span>
      <span class="status-text">
        {{ currentLocation.method === 'GPS' ? 'GPS Activo' : 'WiFi/Cell' }}
      </span>
    </div>
  </div>
</div>
